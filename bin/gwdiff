#!/usr/bin/env bash

# Set up error handling
set -o pipefail
trap 'rm -rf "$temp_dir"' EXIT

# Parse command-line arguments
usage() {
    echo "Usage: $0 [-w] file1 file2"
    echo "  -w  Show word-by-word diff"
}

word_diff=false
while getopts "w" opt; do
    case $opt in
        w)
            word_diff=true
            ;;
        *)
            usage
            exit 1
            ;;
    esac
done
shift $((OPTIND - 1))

# Check if required arguments are provided
if [ $# -ne 2 ]; then
    usage
    exit 1
fi

# Assign arguments to variables
file1="$1"
file2="$2"

# Create a temporary directory
temp_dir=$(mktemp -d)

# Initialize a Git repository and perform the diff
cd "$temp_dir"
git init --quiet
cp "$file1" diff.txt
git add diff.txt
git commit --quiet --message "before"
cp "$file2" diff.txt
if $word_diff; then
    git diff --word-diff
else
    git diff
fi
