#!/bin/bash -e

# Read content from $1 and $2, treating them as potential process substitutions
a=$(cat "$1")
b=$(cat "$2")

options=()

shift 2  # Shift the first two arguments off the list

while [[ $# -gt 0 ]]; do
    case "$1" in
        -p|-u|--patch| \
        --minimal| \
        --compact-summary| \
        --word-diff=*| \
        --word-diff| \
        --color-words| \
        --function-context)
            options+=("$1")
            ;;
        --unified=*)
            options+=("-U${1#--unified=}")
            ;;
        *)
            echo "Unknown option: $1"
            exit 1
            ;;
    esac
    shift
done

DIRECTORY=$(mktemp --directory)
cd $DIRECTORY
git init > /dev/null

echo "$a" > diff.txt
git add diff.txt
git commit --allow-empty-message -m "" > /dev/null

echo "$b" > diff.txt
git diff "${options[@]}"
