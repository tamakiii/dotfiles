#!/bin/bash -e

a=$1
b=$2
shift 2  # Shift the file paths off the argument list

options=()
word_diff=""
color_words=false
function_context=false
unified=3

while [[ $# -gt 0 ]]; do
    case "$1" in
        --word-diff=*)
            word_diff="--word-diff=${1#--word-diff=}"
            options+=("$word_diff")
            ;;
        --color-words)
            color_words=true
            options+=("--color-words")
            ;;
        --function-context)
            function_context=true
            options+=("-W")
            ;;
        --unified=*)
            unified="${1#--unified=}"
            options+=("-U$unified")
            ;;
        *)
            echo "Unknown option: $1"
            exit 1
            ;;
    esac
    shift
done

DIRECTORY=$(mktemp --directory)
cd $DIRECTORY
git init > /dev/null
cp $a diff.txt
git add diff.txt
git commit -m before > /dev/null
cp $b diff.txt
git diff "${options[@]}"
