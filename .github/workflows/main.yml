name: CI

on: [push]

jobs:
  test:
    runs-on: macos-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v1
    - name: Brew cache
      uses: actions/cache@v1
      id: cache
      with:
        path: /Users/runner/Library/Caches/Homebrew
        key: ${{ runner.os }}-brew-${{ hashFiles('**/Brewfile') }}
        restore-keys: |
          ${{ runner.os }}-brew-
    - name: Brew config
      run: brew config
    - name: Uninstall default node
      run: brew uninstall node@12
    - name: Brew install
      run: make -f brew.mk
    - name: Test setup scripts
      run: make install
